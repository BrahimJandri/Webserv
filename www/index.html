<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Server Comprehensive Tester</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for pre elements if content overflows */
        pre {
            max-height: 300px; /* Limit height of response areas */
            overflow-y: auto; /* Enable vertical scrolling */
            white-space: pre-wrap; /* Wrap text within the pre tag */
            word-break: break-word; /* Break long words */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Web Server Comprehensive Tester</h1>

        <!-- Base URL Input -->
        <div class="mb-6">
            <label for="baseUrl" class="block text-gray-700 text-sm font-semibold mb-2">Server Base URL:</label>
            <input type="text" id="baseUrl" value="http://localhost:8080"
                   class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <p class="text-xs text-gray-500 mt-1">Example: http://localhost:8080 or https://your-server.com</p>
        </div>

        <!-- GET Method Section -->
        <div class="mb-8 p-6 bg-blue-50 rounded-lg shadow-inner">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">GET Request</h2>
            <div class="mb-4">
                <label for="getPath" class="block text-blue-700 text-sm font-bold mb-2">Path:</label>
                <input type="text" id="getPath" value="/"
                       class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
            </div>
            <button id="getBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Send GET Request
            </button>
            <div class="mt-4 p-4 bg-blue-100 border border-blue-200 rounded-lg">
                <h3 class="text-blue-700 font-semibold mb-2">GET Response:</h3>
                <pre id="getResponse" class="whitespace-pre-wrap text-sm text-gray-800 break-words"></pre>
            </div>
            <div id="getCookieMessage" class="mt-2 p-3 bg-yellow-100 border border-yellow-200 rounded-lg text-sm text-yellow-800 hidden">
                <!-- Cookie success message for GET -->
            </div>
        </div>

        <!-- CGI Run Section -->
        <div class="mb-8 p-6 bg-purple-50 rounded-lg shadow-inner">
            <h2 class="text-2xl font-semibold text-purple-800 mb-4">CGI Execution (GET)</h2>
            <p class="text-sm text-purple-700 mb-4">This sends a GET request to a path expected to execute a CGI script on the server. Ensure your server is configured for CGI at this path.</p>
            <div class="mb-4">
                <label for="cgiPath" class="block text-purple-700 text-sm font-bold mb-2">CGI Script Path:</label>
                <input type="text" id="cgiPath" value="/cgi-bin/hello.py"
                       class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent">
            </div>
            <button id="cgiBtn"
                    class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Run CGI Script
            </button>
            <div class="mt-4 p-4 bg-purple-100 border border-purple-200 rounded-lg">
                <h3 class="text-purple-700 font-semibold mb-2">CGI Response:</h3>
                <pre id="cgiResponse" class="whitespace-pre-wrap text-sm text-gray-800 break-words"></pre>
            </div>
            <div id="cgiCookieMessage" class="mt-2 p-3 bg-yellow-100 border border-yellow-200 rounded-lg text-sm text-yellow-800 hidden">
                <!-- Cookie success message for CGI -->
            </div>
        </div>


        <!-- POST Method Section -->
        <div class="mb-8 p-6 bg-green-50 rounded-lg shadow-inner">
            <h2 class="text-2xl font-semibold text-green-800 mb-4">POST Request</h2>

            <!-- JSON Data POST -->
            <div class="mb-6 pb-4 border-b border-green-200">
                <h3 class="text-xl font-semibold text-green-700 mb-3">Send JSON Data</h3>
                <div class="mb-4">
                    <label for="postJsonPath" class="block text-green-700 text-sm font-bold mb-2">Path:</label>
                    <input type="text" id="postJsonPath" value="/data"
                           class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent">
                </div>
                <div class="mb-4">
                    <label for="postJsonData" class="block text-green-700 text-sm font-bold mb-2">Data (JSON):</label>
                    <textarea id="postJsonData" rows="4"
                              class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent"
                              placeholder='{"name": "John Doe", "age": 30}'></textarea>
                </div>
                <button id="postJsonBtn"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    Send JSON POST
                </button>
            </div>

            <!-- Image Upload POST -->
            <div class="mt-6">
                <h3 class="text-xl font-semibold text-green-700 mb-3">Upload Image</h3>
                <form id="imageUploadForm" class="space-y-4">
                    <div class="mb-4">
                        <label for="postImagePath" class="block text-green-700 text-sm font-bold mb-2">Upload Path:</label>
                        <input type="text" id="postImagePath" name="upload_path" value="/upload"
                               class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label for="imageFileInput" class="block text-green-700 text-sm font-bold mb-2">Select Image:</label>
                        <input type="file" id="imageFileInput" name="image_file" accept="image/*"
                               class="block w-full text-sm text-gray-500
                                      file:mr-4 file:py-2 file:px-4
                                      file:rounded-full file:border-0
                                      file:text-sm file:font-semibold
                                      file:bg-green-50 file:text-green-700
                                      hover:file:bg-green-100 cursor-pointer">
                    </div>
                    <button type="submit"
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Upload Image
                    </button>
                </form>
            </div>

            <div class="mt-6 p-4 bg-green-100 border border-green-200 rounded-lg">
                <h3 class="text-green-700 font-semibold mb-2">POST Response:</h3>
                <pre id="postResponse" class="whitespace-pre-wrap text-sm text-gray-800 break-words"></pre>
            </div>
            <div id="postCookieMessage" class="mt-2 p-3 bg-yellow-100 border border-yellow-200 rounded-lg text-sm text-yellow-800 hidden">
                <!-- Cookie success message for POST -->
            </div>
        </div>

        <!-- DELETE Method Section -->
        <div class="p-6 bg-red-50 rounded-lg shadow-inner">
            <h2 class="text-2xl font-semibold text-red-800 mb-4">DELETE Request</h2>
            <div class="mb-4">
                <label for="deletePath" class="block text-red-700 text-sm font-bold mb-2">Path to resource:</label>
                <input type="text" id="deletePath" value="/data/example.txt"
                       class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-red-400 focus:border-transparent">
                <p class="text-xs text-gray-500 mt-1">Make sure a file exists at this path on your server (e.g., `www/data/example.txt`) for a successful delete.</p>
            </div>
            <button id="deleteBtn"
                    class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Send DELETE Request
            </button>
            <div class="mt-4 p-4 bg-red-100 border border-red-200 rounded-lg">
                <h3 class="text-red-700 font-semibold mb-2">DELETE Response:</h3>
                <pre id="deleteResponse" class="whitespace-pre-wrap text-sm text-gray-800 break-words"></pre>
            </div>
            <div id="deleteCookieMessage" class="mt-2 p-3 bg-yellow-100 border border-yellow-200 rounded-lg text-sm text-yellow-800 hidden">
                <!-- Cookie success message for DELETE -->
            </div>
        </div>
    </div>

    <script>
        // Get elements
        const baseUrlInput = document.getElementById('baseUrl');

        const getPathInput = document.getElementById('getPath');
        const getBtn = document.getElementById('getBtn');
        const getResponseDiv = document.getElementById('getResponse');
        const getCookieMessageDiv = document.getElementById('getCookieMessage');

        const cgiPathInput = document.getElementById('cgiPath');
        const cgiBtn = document.getElementById('cgiBtn');
        const cgiResponseDiv = document.getElementById('cgiResponse');
        const cgiCookieMessageDiv = document.getElementById('cgiCookieMessage');

        const postJsonPathInput = document.getElementById('postJsonPath');
        const postJsonDataTextarea = document.getElementById('postJsonData');
        const postJsonBtn = document.getElementById('postJsonBtn');
        // Combined POST response and cookie message divs
        const postResponseDiv = document.getElementById('postResponse');
        const postCookieMessageDiv = document.getElementById('postCookieMessage');

        const imageUploadForm = document.getElementById('imageUploadForm');
        const postImagePathInput = document.getElementById('postImagePath');
        const imageFileInput = document.getElementById('imageFileInput');

        const deletePathInput = document.getElementById('deletePath');
        const deleteBtn = document.getElementById('deleteBtn');
        const deleteResponseDiv = document.getElementById('deleteResponse');
        const deleteCookieMessageDiv = document.getElementById('deleteCookieMessage');

        /**
         * Generic function to send an HTTP request and display the response.
         * @param {string} method - The HTTP method (e.g., 'GET', 'POST', 'DELETE').
         * @param {string} path - The request path.
         * @param {any} [bodyContent] - The request body data (string or FormData).
         * @param {HTMLElement} responseDiv - The div to display the response.
         * @param {HTMLElement} cookieMessageDiv - The div to display cookie messages.
         * @param {string} [contentType] - The Content-Type header value. Null for FormData.
         */
        async function sendRequest(method, path, bodyContent, responseDiv, cookieMessageDiv, contentType = 'application/json') {
            const baseUrl = baseUrlInput.value.trim();
            const url = `${baseUrl}${path}`;

            responseDiv.textContent = 'Loading...';
            responseDiv.classList.remove('text-red-600', 'text-green-600', 'text-purple-600'); // Clear previous styling
            cookieMessageDiv.classList.add('hidden'); // Hide previous cookie message

            try {
                const options = {
                    method: method,
                };

                // Only set Content-Type header if bodyContent is not FormData
                // FormData automatically sets the correct multipart/form-data header
                if (bodyContent instanceof FormData) {
                    options.body = bodyContent;
                    // Do NOT set Content-Type header manually for FormData
                } else if (bodyContent) {
                    try {
                        options.headers = { 'Content-Type': contentType };
                        options.body = JSON.stringify(JSON.parse(bodyContent)); // Assume JSON string for now
                    } catch (e) {
                        responseDiv.textContent = 'Error: Invalid JSON in request body.';
                        responseDiv.classList.add('text-red-600');
                        return;
                    }
                }

                const response = await fetch(url, options);
                let responseText;

                // Try to parse as JSON first, if that fails, get as text
                try {
                    const json = await response.json();
                    responseText = JSON.stringify(json, null, 2); // Pretty print JSON
                } catch (e) {
                    responseText = await response.text();
                }

                // --- Display Response Status and Body ---
                if (!response.ok) {
                    responseDiv.textContent = `Error Status: ${response.status} ${response.statusText}\n\n${responseText}`;
                    responseDiv.classList.add('text-red-600');
                } else {
                    let successMessage = `Status: ${response.status} ${response.statusText}`;
                    if (method === 'DELETE') {
                        successMessage = `Resource deleted successfully! Status: ${response.status} ${response.statusText}`;
                    } else if (method === 'POST') {
                        if (response.status === 201) { // 201 Created is common for successful POST that creates a resource
                            successMessage = `Resource created successfully! Status: ${response.status} ${response.statusText}`;
                        } else { // Other successful POSTs (e.g., 200 OK, 202 Accepted)
                            successMessage = `Data submitted successfully! Status: ${response.status} ${response.statusText}`;
                        }
                    } else if (method === 'GET') {
                        successMessage = `Data retrieved successfully! Status: ${response.status} ${response.statusText}`;
                    }
                    responseDiv.textContent = `${successMessage}\n\n${responseText}`;
                    // Add specific color for CGI requests
                    if (path.startsWith('/cgi-bin/')) {
                        responseDiv.classList.add('text-purple-600');
                    } else {
                        responseDiv.classList.add('text-green-600');
                    }
                }

                // --- Cookie Detection and Message Display ---
                const setCookieHeader = response.headers.get('Set-Cookie'); // Note: 'set-cookie' is case-insensitive
                if (setCookieHeader) {
                    // Browsers can return multiple Set-Cookie headers, fetch.headers.get combines them with ', '
                    cookieMessageDiv.textContent = `Server set cookie(s): ${setCookieHeader}`;
                    cookieMessageDiv.classList.remove('hidden');
                } else {
                    cookieMessageDiv.classList.add('hidden');
                }

            } catch (error) {
                responseDiv.textContent = `Network Error: ${error.message}. Check if your server is running and the URL is correct.`;
                responseDiv.classList.add('text-red-600');
                console.error('Fetch error:', error);
            }
        }

        // Event Listeners
        getBtn.addEventListener('click', () => sendRequest('GET', getPathInput.value, null, getResponseDiv, getCookieMessageDiv));
        cgiBtn.addEventListener('click', () => sendRequest('GET', cgiPathInput.value, null, cgiResponseDiv, cgiCookieMessageDiv));
        postJsonBtn.addEventListener('click', () => sendRequest('POST', postJsonPathInput.value, postJsonDataTextarea.value, postResponseDiv, postCookieMessageDiv, 'application/json'));
        deleteBtn.addEventListener('click', () => sendRequest('DELETE', deletePathInput.value, null, deleteResponseDiv, deleteCookieMessageDiv));

        // Event Listener for Image Upload Form
        imageUploadForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission

            const path = postImagePathInput.value;
            const file = imageFileInput.files[0];

            if (!file) {
                postResponseDiv.textContent = 'Please select a file to upload.';
                postResponseDiv.classList.add('text-red-600');
                return;
            }

            const formData = new FormData();
            formData.append('image_file', file); // 'image_file' is the name of the file input, matches 'name' attribute

            // Pass null for contentType as FormData handles it automatically
            await sendRequest('POST', path, formData, postResponseDiv, postCookieMessageDiv, null);
        });

    </script>
</body>
</html>